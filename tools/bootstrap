#!/usr/bin/env node

var path = require('path');
var cp = require('child_process');

if (process.platform === 'linux' && process.arch === 'ia32') {
    console.error('Building on Linux ia32 is not supported.');
    process.exit(1);
}

process.chdir(path.dirname(__dirname));

var env = process.env;
env.npm_config_disturl = 'https://atom.io/download/atom-shell';
env.npm_config_target = '0.35.4';
// build ia32 on Windows 32/64-bit and x64 on Linux
env.npm_config_arch = (process.platform === 'win32' ? 'ia32' : 'x64');

var child = cp.exec('npm install --msvs_version=2013', 
                    {
                        env: env
                    },
                    function(error, stdout, stderr) {
                        if (error) {
                            process.exit(error.code || 1);
                        }
                    });
child.stderr.pipe(process.stderr);
child.stdout.pipe(process.stdout);
