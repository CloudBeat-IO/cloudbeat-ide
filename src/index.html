<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title></title>

    <link href="css/toolbar.css" rel="stylesheet" type="text/css" />
    <link href="css/editor.css" rel="stylesheet" type="text/css" />
    <link href="css/splitter.css" rel="stylesheet" type="text/css" />
    <link href="css/logger.css" rel="stylesheet" type="text/css" />

    <script type="text/javascript">window.$ = window.jQuery = require('./jquery.min.js');</script>
    <script src="splitter.js" type="text/javascript" charset="utf-8"></script>

    <style type="text/css" media="screen">
        html, body {
            overflow: hidden;
            margin: 0;
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body>
    <div id="hLayout">
        <div id="paneMain"></div>
        <div id="paneLog"></div>
    </div>

    <script>
        var Toolbar = require('./toolbar');
        var Editor = require('./editor');
        var Logger = require('./logger');
        var doc = require('./doc');
        var ipc = require('ipc');
        var fs = require('fs');
        var remote = require('remote');
        var dialog = remote.require('dialog');

        document.onkeydown = function(evt) {
            if (evt.keyCode == 8) {     // cancel backspace to prevent 'Back' action
                event.preventDefault();
            }
        };

        // toolbar
        var toolbar = new Toolbar();
        document.body.insertBefore(toolbar, document.body.firstChild);

        // layout
        $("#hLayout").splitter({ type: "h", anchorToWindow: true, sizeBottom: true });

        // editor
        var editor = new Editor(); 
        ipc.on('file-open', function () {
            var file = dialog.showOpenDialog(
                remote.getCurrentWindow(), 
                { properties: [ 'openFile', 'openFile' ] }
            );
            if (file) {
                editor.currentFilename = file[0];
                fs.readFile(file[0], 'utf8', function (err,data) {
                    if (err) {
                        return console.log(err);
                    }
                    editor.setContent(data);
                    toolbar.btnSave.disable();
                });
            }
        });
        $('#paneMain').bind('splitresize', function(){
            editor.editor.resize(); 
        }); 
        var paneMain = document.getElementById('paneMain');
        paneMain.appendChild(editor);
 
        // apidoc div
        var apiDoc = this.el = document.createElement('div');
        apiDoc.setAttribute('id', 'apidoc');
        apiDoc.setAttribute('style', 'display:none;');
        document.body.appendChild(apiDoc);

        // docs
        var docs = doc.init();

        // logger
        var logger = new Logger();
        document.getElementById('paneLog').appendChild(logger);
    </script>
</body>
</html>